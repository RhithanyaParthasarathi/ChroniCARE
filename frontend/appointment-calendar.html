<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChroniCARE - Book Appointment</title>
   
    <!-- Link to your ORIGINAL appointment-calendar.css -->
    <link rel="stylesheet" href="appointment-calendar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<!-- NO style tag added here, assuming CSS is external -->

<body>

    <!-- Original Header Component (if you had one) -->
    <!-- <header class="page-header"> ... </header> -->

    <main>
        <div class="container">
            <div class="header">
                <span>Dr. Sita devi's Clinic</span>
                <span>Book a session</span>
            </div>

            <div class="calendar-container">
                <div class="calendar-header">
                    <button id="prevMonthBtn"><</button>
                    <h3 id="currentMonthYear"></h3>
                    <button id="nextMonthBtn">></button>
                </div>
                <div class="calendar" id="calendar">
                    <!-- Calendar days will be generated here -->
                </div>
            </div>

            <div class="time-slots-container">
                <h4>Available Time Slots:</h4>
                <div id="timeSlots">
                    <!-- Time slots will be displayed here -->
                    <p>Select a date to view available time slots.</p>
                </div>
                 <!-- ADDED: Proceed to Pay Button Container (Initially Hidden) -->
                 <div id="proceedToPayContainer" style="display: none; text-align: center; margin-top: 20px;">
                    <button id="proceedToPayBtn" class="proceed-button">
                        <i class="fas fa-credit-card"></i> Proceed to Pay
                    </button>
                </div>
            </div>
        </div>

        <button class="back-button" onclick="goBack()">Back</button>
    </main>

    <!-- Original Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
        </a>
        <a href="health-monitor.html" class="nav-item">
           <i class="fa-solid fa-medkit"></i>
            <span>Health Monitor</span>
        </a>
        <a href="telemedicine.html" class="nav-item active">
            <i class="fa-solid fa-video"></i>
            <span>Telemedicine</span>
        </a>
        <a href="profile.html" class="nav-item">
            <i class="fa-solid fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>



    <script>
        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        let currentDate = new Date();
        let selectedDate = null;
        let selectedTime = null; // ADDED: Variable to store selected time

        const calendarDiv = document.getElementById('calendar');
        const currentMonthYearH3 = document.getElementById('currentMonthYear');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');
        const timeSlotsDiv = document.getElementById('timeSlots');
        // ADDED: Get the proceed button elements
        const proceedToPayContainer = document.getElementById('proceedToPayContainer');
        const proceedToPayBtn = document.getElementById('proceedToPayBtn');

        function generateCalendar(year, month) {
            // --- (Keep your original generateCalendar logic EXACTLY as it was) ---
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 (Sunday) to 6 (Saturday)

            let calendarHTML = `<div class="day-name">S</div>
                                <div class="day-name">M</div>
                                <div class="day-name">T</div>
                                <div class="day-name">W</div>
                                <div class="day-name">T</div>
                                <div class="day-name">F</div>
                                <div class="day-name">S</div>`;

            for (let i = 0; i < startingDay; i++) {
                calendarHTML += '<div class="day"></div>';
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                // NOTE: If you want to disable past dates, you'd add logic here, but keeping it simple based on original code
                calendarHTML += `<div class="day" data-date="${dateStr}">${day}</div>`;
            }

            calendarDiv.innerHTML = calendarHTML;
            currentMonthYearH3.textContent = `${monthNames[month]} ${year}`;

            // Add click listeners to the days
            document.querySelectorAll('.calendar .day[data-date]').forEach(dayElement => { // Ensure listener only on actual dates
                dayElement.addEventListener('click', function() {
                    //Remove selected class from previously selected date
                    document.querySelectorAll('.calendar .day.selected').forEach(d => d.classList.remove('selected')); // Use .selected from CSS

                    //Select the clicked date
                    this.classList.add('selected');
                    selectedDate = this.dataset.date;

                    // ADDED: Reset time selection and hide proceed button when date changes
                    selectedTime = null;
                    proceedToPayContainer.style.display = 'none';
                    document.querySelectorAll('.time-slot.selected').forEach(ts => ts.classList.remove('selected')); // Clear time selection visual

                    //Display the time slots for the selected date
                    displayTimeSlots(selectedDate);
                });
            });
        }

        function displayTimeSlots(date) {
            // --- (Keep your original getAvailableTimeSlots logic) ---
            const timeSlots = getAvailableTimeSlots(date);

            let timeSlotsHTML = '';
            if (timeSlots.length === 0) {
                timeSlotsHTML = "<p>No time slots available for this date.</p>";
                proceedToPayContainer.style.display = 'none'; // ADDED: Hide button if no slots
            } else {
                timeSlots.forEach(time => {
                    // ADDED: data-time attribute to store the time value
                    timeSlotsHTML += `<div class="time-slot" data-time="${time}">${time}</div>`;
                });
            }
            timeSlotsDiv.innerHTML = timeSlotsHTML;

            // ADDED: Add click listeners to the newly created time slots
            document.querySelectorAll('.time-slot').forEach(slotElement => {
                slotElement.addEventListener('click', function() {
                    // Remove selected class from previously selected time slot
                     document.querySelectorAll('.time-slot.selected').forEach(ts => ts.classList.remove('selected'));

                    // Add selected class to the clicked time slot
                    this.classList.add('selected'); // Uses .selected class defined in CSS
                    selectedTime = this.dataset.time; // Store the selected time

                    // Show the "Proceed to Pay" button
                    proceedToPayContainer.style.display = 'block';
                });
            });
        }

        // --- (Keep your original getAvailableTimeSlots function EXACTLY as it was) ---
        function getAvailableTimeSlots(date) {
            let availableTimeSlots = ['09:00 AM', '10:00 AM', '11:00 AM', '02:00 PM', '03:00 PM'];
            return availableTimeSlots;
        }

        // --- Event Listeners ---

        // Month Navigation (Original logic + hide button)
        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            timeSlotsDiv.innerHTML = "<p>Select a date to view available time slots.</p>";
            proceedToPayContainer.style.display = 'none'; // ADDED: Hide button
            selectedDate = null; // ADDED: Reset selections
            selectedTime = null;
        });

        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            timeSlotsDiv.innerHTML = "<p>Select a date to view available time slots.</p>";
            proceedToPayContainer.style.display = 'none'; // ADDED: Hide button
            selectedDate = null; // ADDED: Reset selections
            selectedTime = null;
        });
       
        // ADDED: Proceed to Pay Button Click Listener
        proceedToPayBtn.addEventListener('click', () => {
            if (selectedDate && selectedTime) {
                // Navigate to the payment page
                window.location.href = 'payment.html';
            } else {
                // This alert ideally shouldn't be needed if the button is only shown when time is selected
                alert("Please select a date and time slot first.");
            }
        });


        // --- (Keep your original goBack function EXACTLY as it was) ---
        function goBack() {
             // Make sure this points to the correct previous page based on your app flow
            window.location.href = 'telemedicine.html'; // Example: assuming this is correct
        }

        // Initial calendar generation
        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    </script>
</body>

</html>