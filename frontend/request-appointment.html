<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChroniCARE - Request Appointment</title>
    <link rel="stylesheet" href="request-appointment.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>

    <header>
        <h1>Request Appointment</h1>
        <h3>Find the Best Doctors near you </h3>
    </header>

    <main>
        <div class="doctor-list" id="doctor-list-container">
            <!-- Doctors will be loaded here -->
        </div>


        <button class="back-button" onclick="goBack()">Back</button>
    </main>
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
        </a>
        <a href="health-monitor.html" class="nav-item">
            <i class="fa-solid fa-medkit"></i>
            <span>Health Monitor</span>
        </a>
        <a href="telemedicine.html" class="nav-item active">
            <i class="fa-solid fa-video"></i>
            <span>Telemedicine</span>
        </a>
        <a href="profile.html" class="nav-item">
            <i class="fa-solid fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>

    <script>
        function goBack() {
            window.location.href = 'telemedicine.html'; // Modified link
        }

        document.addEventListener('DOMContentLoaded', function() {
        const doctorListContainer = document.getElementById('doctor-list-container');

         const generateDoctorCard = (doctor) => {
                return `
                    <div class="doctor-card">
                        <h3>Dr. ${doctor.username}</h3>
                        <div class="specialty">General</div> <!-- Example, replace with real specialty if you have it -->
                        <div class="rating">
                        <span class="star">★★★★★</span>
                        </div>
                        <button class="request-button" data-doctor-id="${doctor.id}" data-doctor-name="${doctor.username}">Request</button>
                    </div>
                `;
            };

            const loadDoctors = async () => {
            try {
                const response = await fetch('http://127.0.0.1:8000/appointments/doctors');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const doctors = await response.json();

                //Generate the cards
                  if (doctors) {
                      doctorListContainer.innerHTML = doctors.map(generateDoctorCard).join('');
                  }
                else
                    doctorListContainer.innerHTML = "<p>There are no Doctors!</p>";

                 //Reattch the Listener, because its a dynamic load
                 document.querySelectorAll('.request-button').forEach(button => {
                    button.addEventListener('click', function() {
                    const doctorId = this.dataset.doctorId;
                    const doctorName = this.dataset.doctorName; // Get the doctor's name
                    window.location.href = `appointment-calendar.html?doctor_id=${doctorId}&doctor_name=${encodeURIComponent(doctorName)}`; // Pass the doctor's name as a URL parameter
                  });
});
            } catch (error) {
                   console.error('There was a problem loading the doctors: ' + error);
                   doctorListContainer.innerHTML = "<p>There was an issue with the server!</p>";
            }
        };
        loadDoctors();
 });
    </script>
</body>

</html>